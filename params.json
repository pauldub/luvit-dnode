{"name":"Luvit-dnode","tagline":"Substack's dnode ported to luvit!","body":"## luvit-dnode\r\n\r\n[![Build Status](https://travis-ci.org/pauldub/luvit-dnode.svg?branch=master)](https://travis-ci.org/pauldub/luvit-dnode)\r\n\r\nThis a port of [dnode.js](https://github.com/substack/dnode) from [substack](http://substack.net/). dnode is a rpc system allowing clients and servers to communicate with each other.  I decided to write this port for luvit after reading this article: [Top 10 inventions at Browserling](http://www.catonmat.net/blog/top-10-browserling-inventions/). My goal is to port upnode and airport aswell, and maybe seaport too.\r\n\r\nIt looks like the simple example is working but more work is needed. Right now a good portion of the node.js test suite has been ported, performance will be tested after implementation is correct enough (at least when client functions are accessible from server and directly piping nodes to each other is working). \r\n\r\nAfter that, I want to cross test both implementations by running the test suite and interleaving node.js and luvit clients and servers.\r\n\r\nA simple example server that should run on Heroku and that works fine on dokku is available: [pauldub/dnode-heroku-example](https://github.com/pauldub/dnode-heroku-example).\r\n\r\nI am also wondering if luvit can also be used with [OpenResty](http://openresty.org), and allow one to forward urls to dnodes, or something like that.\r\n\r\n## Usage\r\n\r\nInstall deps with `lui`, this will fetch dependencies under `modules/`. Lui is available at [dvv/luvit-lui](https://github.com/dvv/luvit-lui).\r\n\r\n### Example Server\r\n\r\n```lua\r\nlocal dnode = require('dnode')\r\n\r\nlocal server = dnode:new({\r\n\thello = function(cb)\r\n\t\tcb(\"hello world!\")\r\n\tend\r\n})\r\n\r\nserver:listen(7070)\r\n```\r\n\r\n### Example client\r\n\r\n```lua\r\nlocal dnode = require('dnode')\r\n\r\nlocal client = dnode:new()\r\n\r\nclient:connect(7070, function(remote, conn)\r\n\tremote.hello(function(response)\r\n\t\tprint(response)\r\n\tend)\r\nend)\r\n```\r\n\r\nSee the `tests/` directory for more examples.\r\n\r\n## Tests\r\n\r\nShould write more tests, `bourbon` will eventually run them. For more informations on bourbon, see [racker/luvit-bourbon](https://github.com/racker/luvit-bourbon).\r\n\r\n## Current status\r\n\r\nThings that work:\r\n\r\n- What is currently tested, see `test/` and `test/server` directories.\r\n\r\nThings that are probably wrong:\r\n\r\n- The scrubber might not be exactly right, it doesn't handle links, indexes starts at 1 due to lua table index. I dont't think callbacks from client -> server are ok, I haven't tested it though.\r\n- The walker might not be right too. I've ported it from the ruby version of dnode and some small parts are missing.\r\n- There is a small logger library, this is just actually used for debugging purposes and helping me understanding how things work. Actually they used to be print(dump(...)) statements the logger main purpose is toggling them.\r\n- ~~The arguments for `dnode:listen` and `dnode:connect` are not yet defined and atm sucks badly.~~ `dnode:listen` and `dnode:connect` now work more or less like the node.js version and those arguments orders should be supported: `port`, `port, cb`, `port, host, cb` or `{ port = p, host = h }, cb`. TODO: Test dnode initialization arguments.\r\n- Bits of everything else.\r\n\r\nThings that don't work:\r\n\r\n- No support for links (yet).\r\n- ~~Server doesn't see client functions.~~ This should now be working correctly now, it was a problem in `lib/dnode/server.lua` and the way the handling queue was used.\r\n- Cannot pipe dnodes to each other yet (using `dnode:new`), I don't know exactly why but it might be due to missing parts or messages going to the `handling_queue` and staying there.\r\n\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}